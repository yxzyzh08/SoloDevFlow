# 文档模板使用指南（Document Template Usage）

> 本指南详细说明如何使用文档模板生成规范化的PRD、架构、测试、部署文档

---

## 一、模板文件位置

```
.solodev/templates/
  ├── PRD-backend-template.md           # 后端项目PRD模板
  ├── architecture/                     # 架构文档模板
  │   ├── 00-系统架构总览.md
  │   ├── 01-技术选型.md
  │   ├── 命令设计.md
  │   ├── 数据模型设计.md
  │   └── 集成-模板.md
  ├── testing/                          # 测试文档模板
  │   ├── 00-测试总览-模板.md
  │   ├── E2E测试计划-模板.md
  │   ├── 性能测试方案-模板.md
  │   └── 混沌测试方案-模板.md
  └── deployment/                       # 部署文档模板
      ├── 00-部署总览-模板.md
      ├── 部署手册-模板.md
      ├── 运维手册-模板.md
      └── CICD配置说明-模板.md
```

---

## 二、模板变量系统

### 变量命名规范

所有模板中使用 **中括号风格** 的占位符：

```markdown
> **项目**: [项目名称]
> **版本**: [版本号]
> **迭代**: Iteration X
> **日期**: YYYY-MM-DD
> **模块**: [模块名称]
```

### 变量值来源

| 变量占位符         | 数据来源                              | 示例值                     |
| ------------------ | ------------------------------------- | -------------------------- |
| `[项目名称]`       | state.json → project.name             | AI超级个体开发助手         |
| `[项目描述]`       | state.json → project.description      | 一个完整的人机协作开发流程 |
| `[版本号]`         | state.json → iterations[current].version | v1.0                    |
| `[迭代]`           | state.json → currentIteration         | Iteration 1                |
| `YYYY-MM-DD`       | 当前日期（生成文档时）                | 2025-12-13                 |
| `[模块名称]`       | 当前处理的模块名称（任务上下文）      | 文档模板模块               |
| `[接口名称]`       | 根据文档内容推断                      | getUserInfo()              |
| `[数据库名]`       | 根据技术栈推断或询问用户              | PostgreSQL                 |

### 变量填充优先级

```
优先级1: 从 state.json 读取固定信息
  ├─ project.name
  ├─ project.description
  ├─ currentIteration
  └─ iterations[current].version

优先级2: 从任务上下文推断
  ├─ 当前模块名称（从state.json的currentModule）
  ├─ 当前日期（new Date()）
  └─ 当前阶段（currentPhase）

优先级3: 询问用户（仅当无法推断时）
  └─ "请提供 [缺失的信息]"
```

---

## 三、模板使用流程

### 阶段1: 需求分析（PRD模板）

```
步骤1: 用户执行 /start-requirements [模块名]
  ↓
步骤2: AI读取 PRD-backend-template.md
  ↓
步骤3: AI填充变量
  - 从state.json读取：项目名、版本号、迭代
  - 从上下文获取：模块名、当前日期
  ↓
步骤4: AI基于澄清结果填充模板内容
  - 用户故事
  - 验收标准
  - 数据模型
  - 命令/接口清单
  ↓
步骤5: 生成完整PRD到 docs/requirements/iteration-X/[模块名]-PRD.md
  ↓
步骤6: 提交给用户审批
```

### 阶段2: 架构设计（架构模板）

```
步骤1: 用户执行 /start-architecture
  ↓
步骤2: AI决定使用哪些架构模板
  - 简单模块：仅在 00-系统架构总览.md 中描述
  - 复杂模块：创建独立的 模块-[模块名]-架构.md
  - 命令体系：使用 命令设计.md 模板
  - 数据模型：使用 数据模型设计.md 模板
  - 复杂集成：使用 集成-模板.md
  ↓
步骤3: AI填充变量并生成文档
  ↓
步骤4: 保存到 docs/architecture/iteration-X/
  ↓
步骤5: 提交给用户审批
```

### 阶段3: 测试（测试模板）

```
步骤1: 用户执行 /start-testing
  ↓
步骤2: AI读取测试模板
  - 00-测试总览-模板.md
  - E2E测试计划-模板.md
  - 性能测试方案-模板.md
  - 混沌测试方案-模板.md
  ↓
步骤3: AI根据PRD的验收标准生成测试用例
  - E2E测试：引用PRD中的验收标准
  - 性能测试：引用PRD中的性能目标
  - 混沌测试：基于架构设计的容错需求
  ↓
步骤4: 填充变量并生成文档
  ↓
步骤5: 保存到 docs/testing/iteration-X/
  ↓
步骤6: 提交给用户审批
```

### 阶段4: 部署（部署模板）

```
步骤1: 用户执行 /start-deployment
  ↓
步骤2: AI读取部署模板
  - 00-部署总览-模板.md
  - 部署手册-模板.md
  - 运维手册-模板.md
  - CICD配置说明-模板.md
  ↓
步骤3: AI根据架构设计填充部署配置
  - 技术栈 → 部署方式
  - 依赖服务 → 部署清单
  - 环境要求 → 前置条件
  ↓
步骤4: 填充变量并生成文档
  ↓
步骤5: 保存到 docs/deployment/iteration-X/
  ↓
步骤6: 提交给用户审批
```

---

## 四、模板填充示例

**模板原文**（PRD-backend-template.md）：
```markdown
> **项目**: [项目名称]
> **版本**: [版本号]
> **迭代**: Iteration X
> **日期**: YYYY-MM-DD

## 一、产品愿景

[描述产品的愿景和目标]
```

**AI填充后**（docs/requirements/iteration-1/文档模板模块-PRD.md）：
```markdown
> **项目**: AI超级个体开发助手
> **版本**: v1.0
> **迭代**: Iteration 1
> **日期**: 2025-12-13

## 一、产品愿景

本产品旨在为独立开发者提供一套完整的AI协作开发工作流，
从需求分析到部署上线的全流程自动化。
```

---

## 五、模板定制化

### 根据项目类型选择模板

| 项目类型         | 使用的模板                       |
| ---------------- | -------------------------------- |
| **后端项目**     | PRD-backend-template.md          |
| **前端项目**     | PRD-frontend-template.md（未来）|
| **全栈项目**     | PRD-fullstack-template.md（未来）|

当前仅实现了后端项目模板，未来可扩展。

### 模板复用与继承

**当前设计**：每个模板独立包含所有必要信息（自包含原则）

**未来优化**（v2.0）：
```
.solodev/templates/
  ├── common/
  │   ├── document-header.md      # 公共头部
  │   └── approval-section.md     # 公共审批区
  └── PRD-backend-template.md     # 引用公共模板
```

---

## 六、模板版本管理

**模板Schema版本**：

```json
// state.json
{
  "templateVersions": {
    "PRD": "1.0.0",
    "architecture": "1.0.0",
    "testing": "1.0.0",
    "deployment": "1.0.0"
  }
}
```

**模板迁移**（当模板结构变化时）：
- 旧版本生成的文档保持不变
- 新版本使用新模板
- 提供迁移脚本（如需要）

---

## 七、实践原则

### 1. 模板即规范

```
✅ 正确做法：
- 所有PRD文档必须基于模板生成
- 确保文档结构一致性

❌ 错误做法：
- 手写PRD，不使用模板
- 随意修改模板结构
```

### 2. 变量优先从state.json读取

```
✅ 正确做法：
AI: [读取state.json] → 填充 [项目名称] = "AI超级个体开发助手"

❌ 错误做法：
AI: "请提供项目名称"（明明state.json中已有）
```

### 3. 生成时立即填充，不保留占位符

```
✅ 正确做法：
生成的PRD中所有变量已填充：
> **项目**: AI超级个体开发助手
> **日期**: 2025-12-13

❌ 错误做法：
生成的PRD中仍有占位符：
> **项目**: [项目名称]
> **日期**: YYYY-MM-DD
```

### 4. 模板是起点，内容需定制

```
✅ 正确做法：
- 使用模板提供结构
- 根据实际需求填充具体内容
- 可以删除不适用的章节

❌ 错误做法：
- 完全照抄模板示例内容
- 不根据实际情况调整
```
