# 自举工作流程指南（Bootstrap Workflow）

> 本指南详细说明自举阶段的特殊工作流程：功能完成后如何集成到工作流程中

---

## 一、核心理念

### 自举的本质

**定义**：用系统自身来开发系统本身

**本项目的自举特性**：
- 开发一个AI开发助手工具
- 用这个工具本身来辅助开发这个工具
- 每完成一个功能，立即用这个功能来开发后续功能

### 与普通项目的区别

| 维度 | 普通项目 | 自举项目（本项目） |
|------|----------|-------------------|
| **功能使用者** | 最终用户 | **AI自己**（在后续开发中使用） |
| **文档化时机** | 项目完成后 | **功能完成后立即文档化** |
| **规范更新频率** | 迭代间 | **迭代内高频更新** |
| **验证方式** | 用户验证 | **AI使用验证** |

---

## 二、标准流程详解

### 适用范围

**所有功能性特性**：
- ✅ 验证器、命令、工具函数、CLI接口

**不适用**：
- ❌ 纯规范约定、文档更新、Bug修复

### 标准流程（4步）

```
功能实现完成
  ↓
【步骤1】功能验证（使用即测试）
  ↓
【步骤2】规范文档化（4个文档位置）
  ↓
【步骤3】Git提交（workflow_integration类型）
  ↓
【步骤4】验证集成效果（AI能否使用）
```

---

## 三、步骤1：功能验证

### 验证标准

**功能可用，无明显Bug**

### 验证方式（根据功能类型选择）

**验证器类功能**：执行npm命令验证

```bash
npm run validate:state
# 预期：✅ 验证通过 或 ❌ 错误提示清晰
```

**命令类功能**：手动执行命令验证

**工具函数类功能**：编写简单测试或手动调用

### 验证通过标准

- ✅ 功能按预期工作
- ✅ 错误处理符合设计
- ✅ 输出格式正确

---

## 四、步骤2：规范文档化（4个位置）

### 快速决策：我需要更新哪些文档？

| 功能类型 | 位置1<br>CLAUDE.md<br>核心流程 | 位置2<br>专项指南 | 位置3<br>CLAUDE.md<br>原则 | 位置4<br>package.json |
|----------|------|-------|-------|-------|
| **验证器** | ✅ | ✅ | ✅ | ✅ |
| **命令** | ✅ | ✅ | ❌ | ✅ |
| **工具函数** | ✅ | ✅ | ❌ | ❌ |
| **规范约定** | ❌ | ✅ | ✅ | ❌ |

### 位置1：CLAUDE.md 核心工作流程

**何时更新**：功能影响核心工作流程时

**更新位置**：CLAUDE.md 第六节"核心工作流程摘要"

**示例**：
```markdown
### 会话开始流程
1. 验证 state.json 格式（npm run validate:state） ← 新增
2. 读取 .solodev/state.json
3. 分析当前阶段和进度
...
```

### 位置2：相关专项指南

**何时更新**：功能属于某个专项指南范畴时

**更新位置**：`.claude/guides/[专项指南].md`

**专项指南对应关系**：

| 功能类型 | 对应专项指南 |
|----------|-------------|
| 状态管理相关 | state-management.md |
| 文档模板相关 | template-usage.md |
| 代码实现相关 | code-standards.md |
| 测试相关 | testing-standards.md |
| Git相关 | git-integration.md |
| 自举流程相关 | bootstrap-workflow.md |

### 位置3：CLAUDE.md 关键原则总结

**何时更新**：功能引入新的工作原则时

**更新位置**：CLAUDE.md 第七节"关键原则总结"

**示例**：
```markdown
### 验证原则
- ✅ 会话开始时验证 state.json 格式
- ✅ 文档生成后验证引用关系
```

### 位置4：package.json scripts（如适用）

**何时更新**：功能提供CLI命令时

**示例**：
```json
{
  "scripts": {
    "validate:state": "npx tsx src/validators/cli.ts state"
  }
}
```

### 更新决策树

```
功能类型
  ↓
【判断1】是否影响核心工作流程？
  ├─ 是 → 更新CLAUDE.md核心工作流程
  └─ 否 → 跳过

【判断2】是否属于某个专项指南范畴？
  ├─ 是 → 更新对应专项指南
  └─ 否 → 跳过

【判断3】是否引入新的工作原则？
  ├─ 是 → 更新CLAUDE.md关键原则
  └─ 否 → 跳过

【判断4】是否提供CLI命令？
  ├─ 是 → 更新package.json
  └─ 否 → 跳过
```

---

## 五、步骤3：Git提交

### Commit规范

**Type**：使用 `chore(bootstrap)`

**Message格式**：

```bash
git add [相关文件]
git commit -m "$(cat <<'EOF'
chore(bootstrap): 集成[功能名]到工作流程

更新内容：
- CLAUDE.md：[更新说明]
- [专项指南]：[更新说明]
- package.json：[新增命令]（如适用）

集成效果：
- AI现在可以在[场景]使用[功能]
- [功能]已成为标准工作流程的一部分

🤖 Generated with [Claude Code](https://claude.com/claude-code)
Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
EOF
)"
```

### changeHistory记录

在state.json的changeHistory中添加记录（type: "workflow_integration"）

**详细规范**：参见 `.claude/guides/git-integration.md`

---

## 六、步骤4：验证集成效果

### 验证方式

**AI自问自答**：通过回答以下问题验证规范是否清晰

### 4个验证问题

**问题1**：新功能在哪个阶段使用？
- 明确说明适用阶段和触发条件

**问题2**：如何触发/调用新功能？
- 说明调用方式（自动/手动/命令）

**问题3**：新功能的输入输出是什么？
- 明确输入参数和输出格式

**问题4**：新功能失败时如何处理？
- 说明错误类型和处理流程

### 验证通过标准

- ✅ AI能够根据规范准确回答所有验证问题
- ✅ 规范清晰、无歧义
- ✅ AI在后续工作中能够正确使用新功能

### 验证失败的处理

**发现问题** → 完善文档说明 → 增加示例 → Git commit记录文档完善

---

## 七、实践原则

### 原则1：功能实现 ≠ 功能可用

```
代码实现完成 → 立即集成到工作流程 → 功能可用
                      ↓
              规范文档化是功能可用的前提
```

**示例**：
- ✅ 正确：验证器实现完成 → 更新CLAUDE.md + 专项指南 → AI自动使用
- ❌ 错误：验证器实现完成 → 未更新规范 → AI不知道有这个功能

### 原则2：规范更新是高频操作

```
Bootstrap阶段每完成一个功能都要更新规范
这是自举的核心特性，不是额外负担
```

### 原则3：4个位置协同更新

- 根据功能特性，在4个位置中选择合适的位置更新
- 确保AI从不同入口都能发现新功能

### 原则4：集成验证是必需的

```
更新规范 → AI自问自答 → 能准确回答？
                         ├─ 能 → 集成完成
                         └─ 不能 → 完善规范 → 重新验证
```

---

## 八、常见问题

### Q1: 如何判断哪些文档位置需要更新？

**A**: 使用4个判断步骤（见第四节"更新决策树"）

通常，一个功能会更新2-4个位置。

---

### Q2: Git commit message如何写？

**A**: 遵循第五节的commit规范格式：

- Type固定使用 `chore(bootstrap)`
- Subject简洁描述集成的功能
- Body分为"更新内容"和"集成效果"两部分

---

### Q3: 如何验证AI能够使用新功能？

**A**: 通过AI自问自答4个问题（见第六节）

如果AI能够准确回答所有问题，说明规范清晰。

---

## 九、完整示例

### 示例：集成state.json验证器

#### 步骤1：功能验证

```bash
npm run validate:state
# ✅ state.json 验证通过
```

#### 步骤2：规范文档化

**更新的4个位置**：
1. CLAUDE.md：第六节"会话开始流程"新增验证步骤、第七节新增"验证原则"
2. state-management.md：新增第八节"状态验证"
3. package.json：新增 `validate:state` 脚本
4. state.json：更新changeHistory和bootstrap.features

#### 步骤3：Git提交

```bash
git add CLAUDE.md .claude/guides/state-management.md package.json .solodev/state.json
git commit -m "$(cat <<'EOF'
chore(bootstrap): 集成state.json验证器到工作流程

更新内容：
- CLAUDE.md：会话开始流程新增验证步骤、关键原则新增验证原则
- state-management.md：新增第八节"状态验证"
- package.json：新增npm run validate:state命令

集成效果：
- AI现在在每次会话开始时自动验证state.json格式
- 阻断性错误会阻止会话继续，确保状态文件可靠性

🤖 Generated with [Claude Code](https://claude.com/claude-code)
Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
EOF
)"
```

#### 步骤4：验证集成效果

| 验证问题 | AI的回答 |
|----------|----------|
| **Q1**: 在哪个阶段使用？ | 所有阶段。每次会话开始时自动触发。 |
| **Q2**: 如何触发？ | 自动触发（会话开始时）或手动执行 `npm run validate:state` |
| **Q3**: 输入输出？ | 输入 `.solodev/state.json`，输出验证结果（通过/失败+修复建议） |
| **Q4**: 失败如何处理？ | 阻断性错误暂停会话，显示修复建议，等待用户修复后继续 |

✅ **验证通过**：AI能够准确回答所有问题，集成成功。

---

## 十、总结

**记住4步流程**：
1. 功能验证（使用即测试）
2. 规范文档化（4个位置协同更新）
3. Git提交（workflow_integration类型）
4. 验证集成效果（AI自问自答）

**坚持4条原则**：
1. 功能实现 ≠ 功能可用（规范文档化是前提）
2. 规范更新是高频操作（每个功能完成后立即更新）
3. 多位置协同更新（确保AI从不同入口发现新功能）
4. 集成验证是必需的（AI自问自答验证）

---

**相关文档**：
- CLAUDE.md：第二.五节"自举阶段特殊规范"
- state.json：`bootstrap.features` 字段
- git-integration.md：Git提交规范详细说明
