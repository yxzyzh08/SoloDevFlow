# E2E测试计划

> **项目**: [项目名称]
> **版本**: [版本号]
> **迭代**: Iteration X
> **日期**: YYYY-MM-DD

---

## 一、E2E测试概述

### 1.1 测试目标

[描述E2E测试要达到的目标，如：验证所有用户故事的验收标准，确保系统端到端功能正确]

### 1.2 测试策略

**测试方法**：
- 基于用户故事的验收标准
- 模拟真实用户操作流程
- 覆盖正常流程 + 异常流程

**测试工具**：
- [测试框架]（如 Jest / Supertest / Playwright）
- [API测试工具]（如 Supertest / axios）
- [断言库]（如 expect / chai）

---

## 二、测试用例清单

### 2.1 [模块1] - E2E测试用例

#### E2E-001：[测试场景名称]

**对应用户故事**：US-001（docs/requirements/iteration-X/PRD.md#5.1）

**验收标准**：见 PRD 5.1 AC-001

**测试步骤**：
1. [步骤1：描述操作]
2. [步骤2：描述操作]
3. [步骤3：验证结果]

**请求示例**：
```http
POST /api/[endpoint]
Content-Type: application/json

{
  "field1": "value1",
  "field2": "value2"
}
```

**预期响应**：
```json
{
  "success": true,
  "data": {
    "field1": "expectedValue"
  }
}
```

**断言点**：
- [ ] HTTP状态码：200
- [ ] response.success === true
- [ ] response.data.field1 存在且符合预期
- [ ] [其他断言点]

**测试数据**：
- 有效数据：`{ field1: "valid", field2: "valid" }`
- 边界数据：`{ field1: "", field2: 0 }`

**优先级**：P0

**预期结果**：✅ 通过

---

#### E2E-002：[测试场景名称 - 异常流程]

**对应用户故事**：US-001（docs/requirements/iteration-X/PRD.md#5.1）

**验收标准**：见 PRD 5.1 AC-001（反向验证）

**测试步骤**：
1. [步骤1：构造异常输入]
2. [步骤2：发送请求]
3. [步骤3：验证错误处理]

**请求示例**：
```http
POST /api/[endpoint]
Content-Type: application/json

{
  "field1": "invalid"
}
```

**预期响应**：
```json
{
  "success": false,
  "error": {
    "code": "E001",
    "message": "Invalid input"
  }
}
```

**断言点**：
- [ ] HTTP状态码：400
- [ ] response.success === false
- [ ] response.error.code === "E001"
- [ ] 错误信息清晰可读

**测试数据**：
- 缺失必填字段：`{ field2: "value" }`
- 无效字段值：`{ field1: null }`

**优先级**：P1

**预期结果**：✅ 通过

---

### 2.2 [模块2] - E2E测试用例

#### E2E-003：[测试场景名称]

[类似结构...]

---

## 三、端到端流程测试

### 3.1 完整业务流程测试

**流程名称**：[如：用户注册 → 登录 → 创建订单 → 支付]

**对应用户故事**：US-001, US-002, US-003

**测试场景**：

```
步骤1: 用户注册
  → POST /api/register
  → 验证注册成功

步骤2: 用户登录
  → POST /api/login
  → 获取 JWT token

步骤3: 创建订单（使用步骤2的token）
  → POST /api/orders (Authorization: Bearer {token})
  → 验证订单创建成功

步骤4: 查询订单
  → GET /api/orders/{orderId}
  → 验证订单信息正确
```

**测试步骤**：
1. 执行完整流程（步骤1 → 步骤2 → 步骤3 → 步骤4）
2. 验证每个步骤的响应
3. 验证步骤间的数据传递正确（如 token、orderId）
4. 验证最终系统状态正确

**断言点**：
- [ ] 所有步骤HTTP状态码正确
- [ ] 数据在步骤间正确传递
- [ ] 最终状态符合预期（如订单状态为"已创建"）
- [ ] 无数据泄露或污染

**测试数据**：
```javascript
const testData = {
  user: { username: 'testuser', password: 'Test123!' },
  order: { productId: 'P001', quantity: 2 }
};
```

**优先级**：P0

**预期结果**：✅ 通过

---

## 四、异常场景测试

### 4.1 错误处理测试

#### E2E-101：无效的认证token

**测试步骤**：
1. 使用无效或过期的JWT token
2. 调用需要认证的接口
3. 验证返回401错误

**断言点**：
- [ ] HTTP状态码：401
- [ ] 错误信息：Unauthorized
- [ ] 不会暴露敏感信息

---

#### E2E-102：数据库连接失败

**测试步骤**：
1. 模拟数据库不可用（通过环境配置或Mock）
2. 调用需要数据库的接口
3. 验证返回500错误并有友好提示

**断言点**：
- [ ] HTTP状态码：500
- [ ] 错误信息不包含数据库技术细节
- [ ] 日志记录了详细错误信息

---

### 4.2 边界条件测试

#### E2E-201：超大数据量输入

**测试步骤**：
1. 发送包含大量数据的请求（如1000个items）
2. 验证系统是否拒绝或正确处理
3. 验证响应时间在合理范围内

**断言点**：
- [ ] 不会导致系统崩溃
- [ ] 返回明确的错误或成功处理
- [ ] 响应时间 < [X秒]

---

## 五、数据验证测试

### 5.1 数据持久化验证

**测试场景**：验证数据正确写入数据库

**测试步骤**：
1. 通过API创建数据
2. 直接查询数据库验证数据存在
3. 通过API查询数据验证一致性

**断言点**：
- [ ] 数据库中数据存在
- [ ] 数据库数据与API返回一致
- [ ] 时间戳正确记录

---

### 5.2 数据完整性验证

**测试场景**：验证数据约束和关联关系

**测试步骤**：
1. 尝试创建违反约束的数据（如重复的唯一字段）
2. 验证系统拒绝
3. 尝试删除有关联关系的数据
4. 验证系统正确处理（拒绝或级联删除）

**断言点**：
- [ ] 唯一性约束生效
- [ ] 外键约束生效
- [ ] 级联操作正确执行

---

## 六、安全性测试

### 6.1 认证授权测试

#### E2E-301：未认证访问受保护资源

**测试步骤**：
1. 不携带token访问受保护接口
2. 验证返回401

#### E2E-302：越权访问测试

**测试步骤**：
1. 用户A的token访问用户B的资源
2. 验证返回403

---

### 6.2 输入安全测试

#### E2E-401：SQL注入测试

**测试步骤**：
1. 在输入字段中注入SQL语句
2. 验证系统不执行注入的SQL
3. 验证返回400或正常处理

**测试数据**：
```javascript
{ username: "admin' OR '1'='1" }
```

#### E2E-402：XSS测试

**测试步骤**：
1. 在输入字段中注入脚本标签
2. 验证返回的数据已转义
3. 验证脚本不会被执行

**测试数据**：
```javascript
{ content: "<script>alert('XSS')</script>" }
```

---

## 七、并发测试

### 7.1 并发创建测试

**测试场景**：同时创建多个资源

**测试步骤**：
1. 并发发送10个创建请求
2. 验证所有请求都成功
3. 验证数据库中有10条记录
4. 验证无数据竞争问题

---

### 7.2 并发更新测试

**测试场景**：同时更新同一资源

**测试步骤**：
1. 并发发送更新同一资源的请求
2. 验证所有请求都有明确结果（成功或失败）
3. 验证最终数据状态一致
4. 验证无数据丢失

---

## 八、测试执行配置

### 8.1 测试环境配置

```javascript
// test/config/e2e.config.js
module.exports = {
  baseURL: 'http://localhost:3000',
  timeout: 30000,
  retries: 2,
  testMatch: ['**/test/e2e/**/*.spec.ts']
};
```

### 8.2 测试数据准备

**测试数据库**：
- 使用独立的测试数据库
- 每次测试前清空并重新填充种子数据

**Mock服务**：
- 外部API使用Mock服务
- Mock数据路径：`test/fixtures/`

---

## 九、测试代码映射

> 测试代码由AI在实现阶段生成，以下是测试用例与代码文件的映射关系

| 测试用例ID | 测试代码文件                     | 状态     |
| ---------- | -------------------------------- | -------- |
| E2E-001    | test/e2e/[module1]/case-001.spec.ts | 待生成   |
| E2E-002    | test/e2e/[module1]/case-002.spec.ts | 待生成   |
| E2E-003    | test/e2e/[module2]/case-003.spec.ts | 待生成   |

---

## 十、测试通过标准

- [ ] 所有 P0 用例通过率：100%
- [ ] 所有 P1 用例通过率：>= 95%
- [ ] 无严重缺陷（Critical / High）
- [ ] 所有端到端流程测试通过
- [ ] 所有安全测试通过

---

## 十一、审批信息

**提交人**：AI
**提交时间**：YYYY-MM-DD HH:MM:SS
**审批人**：[用户名]
**审批时间**：
**审批结果**：⏳ 待审批 / ✅ 通过 / ❌ 拒绝

**审批意见**：
```
[用户审批意见]
```
