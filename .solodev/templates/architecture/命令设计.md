# 命令设计文档

> **项目**: [项目名称]
> **版本**: [版本号]
> **迭代**: Iteration X
> **日期**: YYYY-MM-DD
> **适用于**: CLI 工具项目

---

## 一、命令体系总览

### 1.1 命令分类

```
命令体系：

  【项目管理命令】
    /init                - 初始化项目
    /command1            - [描述]

  【流程触发命令】
    /start-xxx           - [描述]
    /command2            - [描述]

  【审批命令】
    /approve             - [描述]
    /reject              - [描述]

  【查询命令】
    /status              - [描述]
    /list                - [描述]
```

### 1.2 命令依赖关系

```
/init（必须首先执行）
  ↓
/command1（依赖 init）
  ↓
/command2（依赖 command1）
```

### 1.3 命令清单

| 命令                  | 分类       | 依赖命令   | 频率       |
| --------------------- | ---------- | ---------- | ---------- |
| `/init`               | 项目管理   | 无         | 一次       |
| `/command1 <args>`    | [分类]     | /init      | [频率]     |
| `/command2 <args>`    | [分类]     | /command1  | [频率]     |

---

## 二、命令详细设计

### 2.1 /init - 初始化项目

**描述**：[一句话描述命令用途]

**语法**：
```bash
/init [--option1 <value>] [--option2 <value>]
```

**参数**：

| 参数         | 类型   | 必填 | 默认值     | 说明                   |
| ------------ | ------ | ---- | ---------- | ---------------------- |
| `--option1`  | string | 否   | [默认值]   | [参数说明]             |
| `--option2`  | number | 是   | 无         | [参数说明]             |

**执行流程**：

```
步骤1: [检查前置条件]
  ├─ 检查点1：[描述]
  └─ 检查点2：[描述]
  ↓
步骤2: [执行核心逻辑]
  ├─ 操作1：[描述]
  ├─ 操作2：[描述]
  └─ 操作3：[描述]
  ↓
步骤3: [状态更新]
  ├─ 更新 state.json
  └─ Git commit
  ↓
步骤4: [返回结果]
```

**返回值**：

```typescript
interface CommandResult {
  success: boolean;
  message: string;
  data?: {
    // 返回的具体数据
    [key: string]: any;
  };
}
```

**错误处理**：

| 错误码 | 场景                   | 错误信息                     | 处理方式           |
| ------ | ---------------------- | ---------------------------- | ------------------ |
| E001   | [场景描述]             | "[错误信息]"                 | [如何处理]         |
| E002   | [场景描述]             | "[错误信息]"                 | [如何处理]         |

**示例**：

```bash
# 示例1：使用默认配置
/init

# 示例2：指定参数
/init --option1 "value" --option2 123

# 示例3：[其他典型用法]
/init --option1 "value"
```

**输出示例**：

```
✅ 项目初始化成功

创建的文件：
  - .solodev/state.json
  - .solodev/templates/
  - docs/requirements/
  - docs/architecture/

Git commit: abc123 - "chore: 初始化项目"
```

**状态变更**：

```json
// state.json 变更
{
  "project": {
    "name": "[项目名称]",
    "createdAt": "2025-12-13T10:00:00Z"
  }
}
```

**相关命令**：
- `/command1` - 下一步通常执行此命令
- `/status` - 查看初始化结果

---

### 2.2 /command1 - [命令名称]

**描述**：[一句话描述]

**语法**：
```bash
/command1 <arg1> [--option1 <value>]
```

**参数**：

| 参数         | 类型   | 必填 | 默认值     | 说明                   |
| ------------ | ------ | ---- | ---------- | ---------------------- |
| `arg1`       | string | 是   | 无         | [参数说明]             |
| `--option1`  | string | 否   | [默认值]   | [参数说明]             |

**执行流程**：

```
[类似 /init 的流程描述]
```

**返回值**：

```typescript
[类型定义]
```

**错误处理**：

[错误处理表格]

**示例**：

```bash
[示例命令]
```

**输出示例**：

```
[输出示例]
```

**状态变更**：

```json
[state.json 变更]
```

---

### 2.3 /command2 - [命令名称]

[类似结构...]

---

## 三、命令交互模式

### 3.1 同步命令

**特点**：立即返回结果

**示例命令**：
- `/status`
- `/list`

### 3.2 异步命令（长时间运行）

**特点**：执行过程中显示进度

**示例命令**：
- `/start-implementation`（生成代码 + 运行测试）

**进度显示格式**：
```
正在执行 /start-implementation...
  ✓ 步骤1：生成代码 (完成)
  ⏳ 步骤2：运行单元测试 (进行中...)
  ⏸️  步骤3：更新 state.json (等待)
```

### 3.3 交互式命令（需要用户输入）

**特点**：执行过程中需要用户确认或输入

**示例命令**：
- `/approve`（需要用户确认审批）

**交互示例**：
```
AI: 需求文档已生成，请审核：
    - docs/requirements/PRD.md

    是否审批通过？
    - /approve   通过
    - /reject    拒绝
```

---

## 四、命令扩展机制

### 4.1 自定义命令（v2.0 特性）

[预留：如何让用户定义自己的命令]

### 4.2 命令别名

| 原命令       | 别名       | 说明           |
| ------------ | ---------- | -------------- |
| `/status`    | `/s`       | [说明]         |
| `/approve`   | `/ok`      | [说明]         |

---

## 五、命令实现规范

### 5.1 命令处理器接口

```typescript
interface CommandHandler {
  name: string;
  description: string;
  execute(args: CommandArgs): Promise<CommandResult>;
  validate(args: CommandArgs): ValidationResult;
}
```

### 5.2 参数验证

- 必填参数检查
- 参数类型检查
- 参数值范围检查

### 5.3 错误处理规范

- 错误分类：用户错误 / 系统错误
- 错误信息：清晰、可操作
- 错误恢复：提供恢复建议

---

## 六、命令测试

### 6.1 测试覆盖

- 正常流程测试
- 异常流程测试
- 边界条件测试

### 6.2 测试示例

```typescript
describe('/init command', () => {
  it('should initialize project with default config', () => {
    // 测试代码
  });

  it('should throw error when already initialized', () => {
    // 测试代码
  });
});
```
